---
title: "특수 조건 및 예외 처리"
order: 50
category: "reference"
alwaysApply: false
tags: ["special", "conditions", "exceptions"]
lastUpdated: "2024-01-15"
description: "특수한 비즈니스 조건과 예외 상황 처리 가이드"
---

# 쿠폰 계산 규칙 구조 설계

## ✅ 전제

1. 모든 매장은 **30분 또는 1시간 단위 쿠폰**만 존재한다.
2. 할인 계산기는 **@/rules 지침에 따른 개수 기반 계산**을 수행한다.

---

## ✅ 기본 동작 방식

- 기본 규칙:  
  - 평일 → 총 3시간 = FREE 1개 + PAID 2개 (1시간 기준)
  - 주말 → 총 2시간 = FREE 1개 + WEEKEND/PAID 1개 (1시간 기준)

- 무료 쿠폰은 1개까지만 사용 가능하며, `total_history`에서 이미 사용된 경우 생략

- `my_history`, `total_history`, `available_coupons`를 기반으로 판단함

---

## ✅ B 매장 특수 규칙

- `PAID_30MIN` 쿠폰은 **30분 단위**이므로 개수 기준 계산 시 시간 단위로 변환한다.
- **개수 기반 계산**: 1시간 기준 목표 개수를 30분 단위로 변환
  - 평일: 유료 2개 (1시간 기준) → 4개 (30분 기준)  
  - 주말: 유료 1개 (1시간 기준) → 2개 (30분 기준)
- **무료 쿠폰은 1시간이므로 변환 대상이 아니다.**
- "WEEKEND_1HOUR" 쿠폰은 존재하지 않으므로 "PAID_30MIN" 쿠폰을 사용한다.