---
description: 
globs: 
alwaysApply: true
---
# Playwright 자동화 프로젝트 – 코드 작성 규칙 및 권장 습관


---

## 1. 함수/클래스 정의 원칙

- 함수 하나에는 하나의 역할만 명확히 넣는다 (단일 책임 원칙)
- 함수 이름은 동작/목적이 분명히 드러나게(예: apply_coupons, parse_table 등)
- 매개변수에는 타입/의미 주석(혹은 타입힌트) 필수
- 반환값이 무엇인지(예: True/False, dict, str 등) 주석/Docstring으로 명확히
- 클래스는 상태와 동작이 분리될 때만 사용(불필요한 클래스 남발 금지)


---

## 2. 코드 스타일/포맷팅

- 변수명/함수명은 소문자+_ (snake_case) 원칙
- 상수/설정값은 모두 대문자(예: WAIT_TIME, DISCOUNT_TYPES)
- 한 줄에 너무 많은 기능 넣지 않기(가독성 우선)
- 주요 블록에는 주석 달기, 긴 for/if/while문은 간단 설명 추가


---

## 3. Playwright/Python 자동화 실전 팁

- **await/async 함수**는 반드시 await로 호출
- **예외처리(try/except)**는 각 단계별로, 실패 시 상세 로그 남기기
- **time.sleep 대신** Playwright의 `await page.wait_for_selector()` 활용 권장(더 안정적)
- **셀렉터/입력값**은 src/selectors.py 등 별도 파일에 관리하면 유지보수 편리
- **설정/쿠폰명 등 하드코딩 금지**, config.py 등에서 불러오는 습관
- **로그는 항상 남기기:** 성공/실패/예외 모두 logger.info/error로 기록
- 재시도/실패 후 종료는 반드시 로그 후 진행


---

## 4. 함수/모듈 재사용성

- 비슷한 코드가 2번 이상 나오면 함수로 추출
- 모든 비즈니스 로직(예: 쿠폰 적용 판단)은 함수로 분리,  
  Playwright 단계와 분리 유지
- 공통 기능(팝업 처리 등)은 별도 모듈/클래스로 분리 권장


---

## 5. 테스트/운영 팁

- 함수별로 간단한 테스트 코드(입력-출력 예시) 만들기
- 주요 입력/출력(테이블, 로그 등)은 항상 예시 데이터로 먼저 실험
- 에러 발생시 로그만 보고 문제 원인을 파악할 수 있도록  
  "단계, 입력값, 에러 메시지"를 함께 남기기


---

## 6. 기타 실전 권장 사항

- 실행환경이 바뀌어도 동작할 수 있도록, 경로/환경변수 등은 상대경로/환경변수로 관리
- 코드는 항상 최신 문서(doc/) 기준으로 설계/수정
- 협업시(또는 AI가 코드를 추가 생성할 때) 반드시 기존 함수/구조와 일관성 유지
- 사용자와의 대화에서 답변은 영어로 하지 말고 한국어로 하세요.
- AWS를 사용할 때, ID/PW를 사용할건데, 하드코딩으로 사용한다.aws의 secrets manager 보안 사용하지 말 것
- 불필요한 파일 삭제 시 .cursor/rules 경로의 모든 파일은 삭제 금지
- A 매장 관련 테스트는 모두 100% 검증되었으므로 A 매장 관련 코드는 수정하지 않는다. 단, 공통적으로 관련된 코드라면 수정해야 한다.


---

## 7. 쿠폰 계산 핵심 원칙

- **6_calculation_principles.mdc 필독**: 쿠폰 계산 시 절대 원칙과 검증 체크리스트
- **전체 시간 고려 원칙**: 부족분 = 목표시간 - (기존무료+기존유료+추가무료)
- **AI 실수 방지**: 단순 곱셈 계산 금지, 시간 단위 변환 후 계산 필수
- **재발방지**: 실제 예시와 잘못된 계산 패턴을 명시하여 혼동 방지


---

# (이 규칙 파일은 Cursor AI, GitHub Copilot, 사람 개발자 모두가  
# "AI/자동화 코드를 읽고, 쓰고, 유지보수할 때" 참고하도록 만듭니다.)

