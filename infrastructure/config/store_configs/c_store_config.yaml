# Cë§¤ì¥ ì„¤ì •
store:
  id: "C"
  name: "Cë§¤ì¥"
  website_url: "http://g048.gparking.kr"

login:
  username: "1024"
  password: "1211"
  
# ë¡œê·¸ì¸ ì •ë³´ëŠ” .env íŒŒì¼ì—ì„œ ê´€ë¦¬
# C_STORE_USERNAME, C_STORE_PASSWORD í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©

# ì¿ í° ì„¤ì • (ë””ìŠ¤ì¹´ìš´íŠ¸ ë¡œì§ ë¬¸ì„œ ê¸°ì¤€)
coupons:
  FREE_2HOUR:
    name: "2ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ"
    type: "FREE"  # ëŒ€ë¬¸ì í‘œì¤€í™”
    duration_minutes: 120
    priority: 0
  PAID_1HOUR:
    name: "1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ"
    type: "PAID"  # ëŒ€ë¬¸ì í‘œì¤€í™”
    duration_minutes: 60
    priority: 1

# í• ì¸ ì •ì±… (ë¶„ ë‹¨ìœ„ë¡œ í‘œì¤€í™”)
discount_policy:
  weekday:
    target_hours: 3
    max_coupons: 5
  weekend:
    target_hours: 2
    max_coupons: 3

# ì›¹ ì…€ë ‰í„° (ìŠ¤í¬ë¦°ìƒ· í™•ì¸ í›„ ì—…ë°ì´íŠ¸)
selectors:
  # ë¡œê·¸ì¸ ê´€ë ¨
  login:
    username_input: "#user_id"
    password_input: "#pwd"
    login_button: ".btn"
    car_number_input: "input[placeholder='ì°¨ëŸ‰ë²ˆí˜¸ 2ìë¦¬ ì´ìƒì„ ì…ë ¥í•˜ì„¸ìš”']"
  
  # íŒì—… ì²˜ë¦¬
  popups:
    notice_popup: ".popup"
    ok_button: ".popup-ok"
    close_button: ".popup-close"
    # í• ì¸ê¶Œì ìš© íŒì—… (ì¿ í° ì ìš© í›„ ë°œìƒ)
    discount_apply_popup:
      - 'a:has-text("ë‹«ê¸°")'
      - 'button:has-text("ë‹«ê¸°")'
      - 'text=ë‹«ê¸°'
      - 'a[href*="close"]'
      - '.close-modal'
  
  # ì°¨ëŸ‰ ê²€ìƒ‰
  search:
    car_number_input: "input[placeholder='ì°¨ëŸ‰ë²ˆí˜¸ 2ìë¦¬ ì´ìƒì„ ì…ë ¥í•˜ì„¸ìš”']"
    search_button: ".btn:has-text('ì°¨ëŸ‰ì¡°íšŒ')"
    no_result_message: 'text=ê²€ìƒ‰ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤'
    search_result_table: "#tableID"  # ìŠ¤í¬ë¦°ìƒ·ì—ì„œ í™•ì¸ëœ ì‹¤ì œ í…Œì´ë¸” ID (camelCase)
    vehicle_click_selector: "td:has-text('{car_number}')"  # ì°¨ëŸ‰ë²ˆí˜¸ í´ë¦­ ì…€ë ‰í„°
  
  # ì¿ í° ê´€ë ¨
  coupons:
    # âš ï¸ ì£¼ì˜: C ë§¤ì¥ì€ íŠ¹ìˆ˜í•œ ì¿ í° ì ìš© êµ¬ì¡°ë¥¼ ê°€ì§
    # ì‹¤ì œ ì¿ í° ì ìš©: insert_discount() JavaScript í•¨ìˆ˜ í˜¸ì¶œ ë§í¬
    # í• ì¸ ì´ë ¥ ê´€ë¦¬: tbody[id='discountlist'] í…Œì´ë¸”
    
    # ğŸ¯ ì‹¤ì œ ì¿ í° ì ìš© ë§í¬ ì…€ë ‰í„° (2025-08-21 í™•ì¸ë¨)
    coupon_application_selectors:
      - "a[href*='insert_discount']"      # í•µì‹¬: insert_discount í•¨ìˆ˜ í˜¸ì¶œ ë§í¬ë§Œ
      - "a[onclick*='insert_discount']"   # onclick ì†ì„±ì—ì„œë„ í™•ì¸
      - "*[onclick*='insert_discount']"   # ëª¨ë“  ìš”ì†Œì—ì„œ onclick í™•ì¸
    
    # âŒ í˜¼ë™í•˜ì§€ ë§ ê²ƒ: í• ì¸ ì´ë ¥ ì‚­ì œ ë§í¬
    discount_deletion_selectors:
      - "a[href*='deldiscount']"          # ì‚­ì œ í•¨ìˆ˜ (ì ìš© X)
      - "a.delete"                        # ì‚­ì œ ë²„íŠ¼ í´ë˜ìŠ¤ (ì ìš© X)
    
    # ğŸ“Š í• ì¸ë‚´ì—­ í…Œì´ë¸” ì…€ë ‰í„° (ì´ë ¥ ì¡°íšŒìš© - ì ìš© ìš©ë„ ì•„ë‹˜)
    # 2025-08-21 í…ŒìŠ¤íŠ¸ ê²€ì¦: tbody[id='discountlist'] êµ¬ì¡° í™•ì¸ë¨
    discount_selectors:
      - "tbody[id='discountlist'] tr"  # C ë§¤ì¥ í• ì¸ë‚´ì—­ í…Œì´ë¸” (ë©”ì¸)
      - "#discountlist tr"             # IDë§Œìœ¼ë¡œ ì ‘ê·¼ (ë°±ì—…)
      - "tbody#discountlist tr"        # tbody ëª…ì‹œ (ë°±ì—…)
    
    # ğŸ” í• ì¸ ì´ë ¥ íŒŒì‹± ê·œì¹™ (ê³µí†µ ì¿ í° ê³„ì‚°ê¸° ì—°ë™)
    history_parsing:
      table_identification: "tbody[id='discountlist']"  # ê³ ìœ  ì‹ë³„ì
      cell_structure:
        0: "ì‚­ì œ_ë§í¬"     # <a href="javascript:deldiscount(...)">ì‚­ì œ</a>
        1: "ì ìš©_ë‚ ì§œ"     # "2025-08-21 02:17:39"
        2: "ì¿ í°ëª…"        # "1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ"  
        3: "ìˆ˜ëŸ‰"         # "1ë§¤"
      quantity_extraction: "r'(\\d+)'"  # ì •ê·œì‹: "1ë§¤" â†’ 1
      
    # ğŸ“‹ ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ (2025-08-21)
    verified_history_data:
      example_row: "ì‚­ì œ | 2025-08-21 02:17:39 | 1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ | 1ë§¤"
      parsed_result: {"PAID_1HOUR": 1}
    
    # ğŸ« ì¿ í° ìš°ì„ ìˆœìœ„ ì ìš© ê·œì¹™ (2025-08-21 êµ¬í˜„)
    priority_rules:
      description: "ë¬´ë£Œ ì¿ í° ìš°ì„ , ì‹œê°„ì´ ê¸´ ê²ƒë¶€í„°"
      order:
        1: "2ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ"  # ìµœìš°ì„ 
        2: "1ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ"
        3: "2ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ"  
        4: "1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ"  # ìµœí›„ìˆœìœ„
    
    # ğŸ”— ì‹¤ì œ í™•ì¸ëœ ë§í¬ êµ¬ì¡° (2025-08-21 í…ŒìŠ¤íŠ¸ë¨)
    verified_links:
      "1ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ": "javascript:insert_discount(328304,246);"
      "2ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ": "javascript:insert_discount(328304,247);"
    
    # ğŸ—‚ï¸ ì¿ í° ì´ë¦„ â†’ í‚¤ ë§¤í•‘ (ê³µí†µ ì¿ í° ê³„ì‚°ê¸°ìš©)
    coupon_key_mapping:
      "2ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ": "FREE_2HOUR"
      "ë¬´ë£Œ 2ì‹œê°„í• ì¸": "FREE_2HOUR"
      "1ì‹œê°„ ë¬´ë£Œí• ì¸ê¶Œ": "FREE_1HOUR"  # ì¶”ê°€ë¨
      "ë¬´ë£Œ 1ì‹œê°„í• ì¸": "FREE_1HOUR"    # ì¶”ê°€ë¨
      "1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ": "PAID_1HOUR"
      "ìœ ë£Œí• ì¸ê¶Œ": "PAID_1HOUR"
      "ìœ ë£Œí• ì¸": "PAID_1HOUR"
    
    # ğŸ“‹ C ë§¤ì¥ í…Œì´ë¸” ë°ì´í„° êµ¬ì¡° ì •ë³´ (í• ì¸ ì´ë ¥ìš©)
    table_structure:
      description: "ì‚­ì œë§í¬ | ë‚ ì§œ | í• ì¸ê¶Œëª… | ìˆ˜ëŸ‰"
      coupon_name_cell_index: 2  # ì¿ í°ëª…ì´ ìˆëŠ” ì…€ ì¸ë±ìŠ¤ (0ë¶€í„° ì‹œì‘)
      quantity_cell_index: 3     # ìˆ˜ëŸ‰ì´ ìˆëŠ” ì…€ ì¸ë±ìŠ¤
      has_my_history: false      # C ë§¤ì¥ì€ my_historyê°€ ì—†ìŒ (total_historyë§Œ)
      example: "ì‚­ì œ | 2025-08-21 02:17:39 | 1ì‹œê°„ ìœ ë£Œí• ì¸ê¶Œ | 1ë§¤"
    
  # í˜ì´ì§€ URL (ì¶”ì •)
  urls:
    login: "/login"
    main: "/main"
    coupon: "/coupon"

# ì°¨ëŸ‰ ê²€ìƒ‰ ì‹¤íŒ¨ ê°ì§€ ì„¤ì •
search_failure_detection:
  # ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì‹œë„í•  ê°ì§€ ë°©ë²•ë“¤
  methods:
    - type: "text_pattern"           # Cë§¤ì¥ ì£¼ìš” íŒ¨í„´
      patterns: 
        - "ê²€ìƒ‰ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤"
        - "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"
        - "ì°¨ëŸ‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        - "ë“±ë¡ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤"
        - "ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"
      priority: 1
      
    - type: "locator_check"          # Playwright ë¡œì¼€ì´í„° ì§ì ‘ ì‚¬ìš©
      locators:
        - 'text="ê²€ìƒ‰ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤"'
        - 'text="ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"'
        - 'text="ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"'
      priority: 2
      
    - type: "popup_detection"        # íŒì—…ì°½ ê°ì§€
      selectors:
        - ".popup"
        - ".modal"
        - ".alert"
        - "div[id*='popup']"
      text_patterns: ["ê²€ìƒ‰", "ê²°ê³¼", "ì—†ìŒ", "ì°¨ëŸ‰", "ì¡°íšŒ"]
      priority: 3
      
    - type: "table_check"            # í…Œì´ë¸” ê¸°ë°˜ ê°ì§€ (Cë§¤ì¥ íŠ¹í™”)
      selector: "#tableID"
      empty_indicators: ["ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤", "ì¡°íšŒëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"]
      priority: 4

  # íŒì—… ë‹«ê¸° ì„¤ì •
  popup_close:
    selectors:
      - 'text=OK'
      - 'text=í™•ì¸'
      - 'text=ë‹«ê¸°'
      - 'button:has-text("OK")'
      - 'button:has-text("í™•ì¸")'
      - 'a:has-text("ë‹«ê¸°")'
      - '.popup-ok'
      - '.popup-close'
      - '.btn-close'
      - '.close-modal'
      - 'a[href*="close"]'