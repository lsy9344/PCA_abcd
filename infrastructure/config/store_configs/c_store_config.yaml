# C매장 설정
store:
  id: "C"
  name: "C매장"
  website_url: "http://g048.gparking.kr"

login:
  username: "1024"
  password: "1211"
  
# 로그인 정보는 .env 파일에서 관리
# C_STORE_USERNAME, C_STORE_PASSWORD 환경 변수 사용

# 쿠폰 설정 (디스카운트 로직 문서 기준)
coupons:
  FREE_2HOUR:
    name: "2시간 무료할인권"
    type: "FREE"  # 대문자 표준화
    duration_minutes: 120
    priority: 0
  PAID_1HOUR:
    name: "1시간 유료할인권"
    type: "PAID"  # 대문자 표준화
    duration_minutes: 60
    priority: 1

# 할인 정책 (분 단위로 표준화)
discount_policy:
  weekday:
    target_hours: 3
    max_coupons: 5
  weekend:
    target_hours: 2
    max_coupons: 3

# 웹 셀렉터 (스크린샷 확인 후 업데이트)
selectors:
  # 로그인 관련
  login:
    username_input: "#user_id"
    password_input: "#pwd"
    login_button: ".btn"
    car_number_input: "input[placeholder='차량번호 2자리 이상을 입력하세요']"
  
  # 팝업 처리
  popups:
    notice_popup: ".popup"
    ok_button: ".popup-ok"
    close_button: ".popup-close"
  
  # 차량 검색
  search:
    car_number_input: "input[placeholder='차량번호 2자리 이상을 입력하세요']"
    search_button: ".btn:has-text('차량조회')"
    no_result_message: 'text=검색된 차량이 없습니다'
    search_result_table: "#tableID"  # 스크린샷에서 확인된 실제 테이블 ID (camelCase)
    vehicle_click_selector: "td:has-text('{car_number}')"  # 차량번호 클릭 셀렉터
  
  # 쿠폰 관련
  coupons:
    coupon_list: "#couponList"
    coupon_rows: "#couponList tr"
    apply_button: ".apply-btn"
    discount_history: "#discountHistory"
    
    # 할인내역 테이블 셀렉터 (공통 쿠폰 계산기용)
    # C 매장 특징: tbody ID 기반 식별
    discount_selectors:
      - "tbody[id='discountlist'] tr"  # C 매장 할인내역 테이블
      - "#discountlist tr"             # ID만으로 접근
      - "tbody#discountlist tr"        # tbody 명시
    
    # 쿠폰 이름 → 키 매핑 (공통 쿠폰 계산기용)
    coupon_key_mapping:
      "2시간 무료할인권": "FREE_2HOUR"
      "무료 2시간할인": "FREE_2HOUR"
      "1시간 유료할인권": "PAID_1HOUR"
      "유료할인권": "PAID_1HOUR"
      "유료할인": "PAID_1HOUR"
    
    # C 매장 테이블 데이터 구조 정보
    table_structure:
      description: "빈값 | 날짜 | 할인권명 | 수량"
      coupon_name_cell_index: 2  # 쿠폰명이 있는 셀 인덱스 (0부터 시작)
      quantity_cell_index: 3     # 수량이 있는 셀 인덱스
      has_my_history: false      # C 매장은 my_history가 없음 (total_history만)
      example: " | 2025-08-16 | 2시간 무료할인권 | 1매"
    
  # 페이지 URL (추정)
  urls:
    login: "/login"
    main: "/main"
    coupon: "/coupon"

# 차량 검색 실패 감지 설정
search_failure_detection:
  # 우선순위 순으로 시도할 감지 방법들
  methods:
    - type: "text_pattern"           # C매장 주요 패턴
      patterns: 
        - "검색된 차량이 없습니다"
        - "검색 결과가 없습니다"
        - "차량을 찾을 수 없습니다"
        - "등록된 차량이 없습니다"
        - "조회 결과가 없습니다"
      priority: 1
      
    - type: "locator_check"          # Playwright 로케이터 직접 사용
      locators:
        - 'text="검색된 차량이 없습니다"'
        - 'text="검색 결과가 없습니다"'
        - 'text="조회 결과가 없습니다"'
      priority: 2
      
    - type: "popup_detection"        # 팝업창 감지
      selectors:
        - ".popup"
        - ".modal"
        - ".alert"
        - "div[id*='popup']"
      text_patterns: ["검색", "결과", "없음", "차량", "조회"]
      priority: 3
      
    - type: "table_check"            # 테이블 기반 감지 (C매장 특화)
      selector: "#tableID"
      empty_indicators: ["데이터가 없습니다", "조회된 결과가 없습니다"]
      priority: 4

  # 팝업 닫기 설정
  popup_close:
    selectors:
      - 'text=OK'
      - 'text=확인'
      - 'text=닫기'
      - 'button:has-text("OK")'
      - 'button:has-text("확인")'
      - '.popup-ok'
      - '.popup-close'
      - '.btn-close'